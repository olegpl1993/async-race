(()=>{"use strict";var n={};function e(n,e,t,i){const o=document.createElement(e);return t&&(o.className=t),i&&(o.textContent=String(i)),n.append(o),o}n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(n){if("object"==typeof window)return window}}(),(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var i=t.getElementsByTagName("script");i.length&&(e=i[i.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e})();const t=n.p+"assets/7c0832c05ce5df37ebfe.png";function i(n){return e=this,t=void 0,o=function*(){yield fetch("http://127.0.0.1:3000/garage",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})},new((i=void 0)||(i=Promise))((function(n,r){function c(n){try{d(o.next(n))}catch(n){r(n)}}function a(n){try{d(o.throw(n))}catch(n){r(n)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(n){n(t)}))).then(c,a)}d((o=o.apply(e,t||[])).next())}));var e,t,i,o}function o(n,e){return t=this,i=void 0,r=function*(){return yield fetch(`http://127.0.0.1:3000/engine?id=${n}&status=${e}`,{method:"PATCH"})},new((o=void 0)||(o=Promise))((function(n,e){function c(n){try{d(r.next(n))}catch(n){e(n)}}function a(n){try{d(r.throw(n))}catch(n){e(n)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(n){n(t)}))).then(c,a)}d((r=r.apply(t,i||[])).next())}));var t,i,o,r}function r(n,e){const t=n,i=t.style.left?+t.style.left.slice(0,-1)+.1:0;t.style.left=`${i}%`,i>99&&clearInterval(e)}const c={garagePageNumber:1,garageCarOnPage:7,winnerPageNumber:1,winnerCarOnPage:10,curentWinner:{carId:0,time:0},winnerSort:"",winnerOrder:""};function a(n,e){return t=this,i=void 0,r=function*(){let t;return t=e?yield fetch(`http://127.0.0.1:3000/garage?_page=${n}&_limit=${e}`):yield fetch("http://127.0.0.1:3000/garage"),t},new((o=void 0)||(o=Promise))((function(n,e){function c(n){try{d(r.next(n))}catch(n){e(n)}}function a(n){try{d(r.throw(n))}catch(n){e(n)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(n){n(t)}))).then(c,a)}d((r=r.apply(t,i||[])).next())}));var t,i,o,r}function d(n,e,t,i){return o=this,r=void 0,a=function*(){let o;const r=["http://127.0.0.1:3000/winners?"];n&&r.push(`_page=${n}`),e&&r.push(`_limit=${e}`),t&&r.push(`_sort=${t}`),i&&r.push(`_order=${i}`);const c=r.join("&");return o=n||e||t||i?yield fetch(c):yield fetch("http://127.0.0.1:3000/winners"),o},new((c=void 0)||(c=Promise))((function(n,e){function t(n){try{d(a.next(n))}catch(n){e(n)}}function i(n){try{d(a.throw(n))}catch(n){e(n)}}function d(e){var o;e.done?n(e.value):(o=e.value,o instanceof c?o:new c((function(n){n(o)}))).then(t,i)}d((a=a.apply(o,r||[])).next())}));var o,r,c,a}function s(n,t,i){return a=this,s=void 0,u=function*(){const a=yield o(i,"started"),s=yield a.json(),l=s.distance/s.velocity,u=setInterval((()=>r(t,u)),l/1e3),v=yield o(i,"drive");if(500===v.status&&clearInterval(u),200===v.status&&0===c.curentWinner.carId){c.curentWinner.carId=i,c.curentWinner.time=l;const t=+(l/1e3).toFixed(2),o=yield fetch(`http://127.0.0.1:3000/garage/${i}`),r=yield o.json();e(n,"div","winnerCarWindow",`Winner ${r.name} time ${t}s`);const a=yield d(),s=yield a.json();let u=!0;s.forEach((n=>{n.id===i&&(function(n,e){var t,i,o,r;t=this,i=void 0,r=function*(){yield fetch(`http://127.0.0.1:3000/winners/${n}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})},new((o=void 0)||(o=Promise))((function(n,e){function c(n){try{d(r.next(n))}catch(n){e(n)}}function a(n){try{d(r.throw(n))}catch(n){e(n)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(n){n(t)}))).then(c,a)}d((r=r.apply(t,i||[])).next())}))}(i,{wins:n.wins+1,time:t<n.time?t:n.time}),u=!1)})),u&&(yield function(n){return e=this,t=void 0,o=function*(){yield fetch("http://127.0.0.1:3000/winners",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})},new((i=void 0)||(i=Promise))((function(n,r){function c(n){try{d(o.next(n))}catch(n){r(n)}}function a(n){try{d(o.throw(n))}catch(n){r(n)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(n){n(t)}))).then(c,a)}d((o=o.apply(e,t||[])).next())}));var e,t,i,o}({id:i,wins:1,time:+(l/1e3).toFixed(2)}))}},new((l=void 0)||(l=Promise))((function(n,e){function t(n){try{o(u.next(n))}catch(n){e(n)}}function i(n){try{o(u.throw(n))}catch(n){e(n)}}function o(e){var o;e.done?n(e.value):(o=e.value,o instanceof l?o:new l((function(n){n(o)}))).then(t,i)}o((u=u.apply(a,s||[])).next())}));var a,s,l,u}var l=function(n,e,t,i){return new(t||(t=Promise))((function(o,r){function c(n){try{d(i.next(n))}catch(n){r(n)}}function a(n){try{d(i.throw(n))}catch(n){r(n)}}function d(n){var e;n.done?o(n.value):(e=n.value,e instanceof t?e:new t((function(n){n(e)}))).then(c,a)}d((i=i.apply(n,e||[])).next())}))};function u(n){return l(this,void 0,void 0,(function*(){for(;n.firstChild;)n.removeChild(n.firstChild);const v=[],h=e(n,"div","garageBox"),f=e(h,"div","driverBox"),w=e(f,"div","carRow"),g=e(w,"input","textInput"),y=e(w,"input","colorInput");y.type="color",e(w,"button","button","CREATE").addEventListener("click",(()=>l(this,void 0,void 0,(function*(){const e={name:g.value,color:y.value};yield i(e),u(n)}))));const m=e(f,"div","carRow"),p=e(m,"input","textInput"),b=e(m,"input","colorInput");b.type="color";const x=e(m,"button","button","UPDATE");let E;x.disabled=!0,x.addEventListener("click",(()=>l(this,void 0,void 0,(function*(){const e={name:p.value,color:b.value};yield function(n,e){return t=this,i=void 0,r=function*(){yield fetch(`http://127.0.0.1:3000/garage/${n}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})},new((o=void 0)||(o=Promise))((function(n,e){function c(n){try{d(r.next(n))}catch(n){e(n)}}function a(n){try{d(r.throw(n))}catch(n){e(n)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(n){n(t)}))).then(c,a)}d((r=r.apply(t,i||[])).next())}));var t,i,o,r}(E,e),u(n)}))));const P=[],C=e(f,"div","carRow"),k=e(C,"button","button reset","RESET");k.disabled=!0,k.addEventListener("click",(()=>{P.forEach((n=>{!function(n,e,t){var i,r,c,a;i=this,r=void 0,a=function*(){const t=n,i=yield o(e,"stopped");(yield i.json())&&clearInterval(void 0),t.style.left="0%"},new((c=void 0)||(c=Promise))((function(n,e){function t(n){try{d(a.next(n))}catch(n){e(n)}}function o(n){try{d(a.throw(n))}catch(n){e(n)}}function d(e){var i;e.done?n(e.value):(i=e.value,i instanceof c?i:new c((function(n){n(i)}))).then(t,o)}d((a=a.apply(i,r||[])).next())}))}(n.node,n.id)})),c.curentWinner.carId=0,c.curentWinner.time=0,n.childNodes[1]&&n.removeChild(n.childNodes[1]);const e=document.querySelectorAll("button");setTimeout((()=>{e.forEach((n=>{n.disabled=!1})),x.disabled=!0,k.disabled=!0,v.forEach((n=>{n.disabled=!0}))}),2e3)})),e(C,"button","button","RACE").addEventListener("click",(()=>{document.querySelectorAll("button").forEach((n=>{n.disabled=!0})),setTimeout((()=>{k.disabled=!1}),12e3),P.forEach((e=>{s(n,e.node,e.id)}))})),e(C,"button","button","GENERATE CARS").addEventListener("click",(()=>l(this,void 0,void 0,(function*(){const e=[];for(let n=0;n<100;n+=1){const n=["Toyota","Mercedes","BMW","Honda","Volkswagen","Ford","Hyundai","Audi","Nissan","Porsche"],t=["Martin","X5","X6","X7","X8","X9","Roadster","2","3","4","5","6","7","8","9","Sedan","Hatchback","D-Class","C-Class","B-Class","A-Class","S-Class"],o=`${n[Math.floor(Math.random()*n.length)]} ${t[Math.floor(Math.random()*t.length)]}`,r="0123456789ABCDEF";let c="#";for(let n=0;n<6;n+=1)c+=r[Math.floor(16*Math.random())];const a={name:o,color:c};e.push(i(a))}yield Promise.all(e),u(n)}))));const S=yield a(),N=yield S.json();e(h,"div","numberCars",`Garge (${N.length})`),e(h,"div","numberPage",`Page #${c.garagePageNumber}`);const O=e(h,"div","trackBox"),B=yield a(c.garagePageNumber,c.garageCarOnPage);(yield B.json()).forEach((i=>{const c=e(O,"div","trackRow"),a=e(c,"div","selectRemoveNameRow");e(a,"button","button","SELECT").addEventListener("click",(()=>{p.value=i.name,E=i.id,x.disabled=!1})),e(a,"button","button","REMOVE").addEventListener("click",(()=>l(this,void 0,void 0,(function*(){const e=yield d();(yield e.json()).forEach((n=>l(this,void 0,void 0,(function*(){n.id===i.id&&(yield function(n){return e=this,t=void 0,o=function*(){yield fetch(`http://127.0.0.1:3000/winners/${n}`,{method:"DELETE"})},new((i=void 0)||(i=Promise))((function(n,r){function c(n){try{d(o.next(n))}catch(n){r(n)}}function a(n){try{d(o.throw(n))}catch(n){r(n)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(n){n(t)}))).then(c,a)}d((o=o.apply(e,t||[])).next())}));var e,t,i,o}(i.id))})))),yield function(n){return e=this,t=void 0,o=function*(){yield fetch(`http://127.0.0.1:3000/garage/${n}`,{method:"DELETE"})},new((i=void 0)||(i=Promise))((function(n,r){function c(n){try{d(o.next(n))}catch(n){r(n)}}function a(n){try{d(o.throw(n))}catch(n){r(n)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(n){n(t)}))).then(c,a)}d((o=o.apply(e,t||[])).next())}));var e,t,i,o}(i.id),u(n)})))),e(a,"div","carName",i.name);const s=e(c,"div","mainRow"),h=e(s,"div","startStopRow"),f=e(s,"div","mainTrackRow"),w=e(f,"img","flagBox");w.alt="flag",w.src=t,w.width=60,w.height=60;const g=e(f,"div","carBox");g.innerHTML='<svg width="80" height="50" class="carSVG" viewBox="40 -55 180 180" xmlns="http://www.w3.org/2000/svg">\n    <g><title>background</title><rect fill="none" id="canvas_background" height="131" width="258" y="-1" x="-1"/></g>\n    <g><title>Layer 1</title>\n    <g id="svg_1" stroke=" none" transform="translate(1.4065934419631958,1.4065934419631958) scale(2.809999942779541) ">\n    <circle id="svg_2" stroke=" none" r="1.955" cy="34.015458" cx="71.090872"/>\n    <circle id="svg_3" stroke=" none" r="1.955" cy="34.015458" cx="20.120872"/>\n    <path id="svg_4" stroke=" none" stroke-linecap="round" d="m75.834872,13.285458l-7.987,-1.22l-2.35,-2.574c-5.599,-6.132 -13.571,-9.649 -21.874,-9.649l-6.245,0c-1.357,0 -2.696,0.107 -4.016,0.296c-0.022,0.004 -0.044,0.006 -0.066,0.01c-7.799,1.133 -14.802,5.468 -19.285,12.106c-7.95,2.899 -13.656,10.344 -13.656,17.938c0,3.254 2.647,5.9 5.9,5.9l3.451,0c0.969,4.866 5.269,8.545 10.416,8.545s9.447,-3.679 10.416,-8.545l30.139,0c0.969,4.866 5.27,8.545 10.416,8.545s9.446,-3.679 10.415,-8.545l2.947,0c3.254,0 5.9,-2.646 5.9,-5.9c0,-8.511 -6.106,-15.621 -14.521,-16.907zm-32.21,-9.443c7.065,0 13.848,2.949 18.676,8.094l-22.481,0l-3.267,-8.068c0.275,-0.009 0.55,-0.026 0.826,-0.026l6.246,0zm-11.189,0.516l3.068,7.578l-16.176,0c3.457,-3.883 8.046,-6.527 13.108,-7.578zm-12.313,36.279c-3.652,0 -6.623,-2.971 -6.623,-6.622c0,-3.652 2.971,-6.623 6.623,-6.623s6.623,2.971 6.623,6.623c0,3.652 -2.971,6.622 -6.623,6.622zm50.971,0c-3.652,0 -6.623,-2.971 -6.623,-6.622c0,-3.652 2.971,-6.623 6.623,-6.623c3.651,0 6.622,2.971 6.622,6.623c0,3.652 -2.97,6.622 -6.622,6.622z"/>\n    </g></g></svg>',g.style.fill=i.color,P.push({node:g,id:i.id});const y=e(h,"button","button","A"),m=e(h,"button","button stopBtn","B");let b;v.push(m),m.disabled=!0,y.addEventListener("click",(()=>l(this,void 0,void 0,(function*(){y.disabled=!0,m.disabled=!1;const n=yield o(i.id,"started"),e=yield n.json(),t=e.distance/e.velocity;b=setInterval((()=>r(g,b)),t/1e3),500===(yield o(i.id,"drive")).status&&clearInterval(b)})))),m.addEventListener("click",(()=>l(this,void 0,void 0,(function*(){y.disabled=!1,m.disabled=!0;const n=yield o(i.id,"stopped");(yield n.json())&&clearInterval(b),g.style.left="0%"})))),e(c,"div","dottedRow")}));const L=e(h,"div","prevNextRow");return e(L,"button","button","PREV").addEventListener("click",(()=>{c.garagePageNumber>1&&(c.garagePageNumber-=1,u(n))})),e(L,"button","button","NEXT").addEventListener("click",(()=>{c.garagePageNumber*c.garageCarOnPage<N.length&&(c.garagePageNumber+=1,u(n))})),h}))}var v=function(n,e,t,i){return new(t||(t=Promise))((function(o,r){function c(n){try{d(i.next(n))}catch(n){r(n)}}function a(n){try{d(i.throw(n))}catch(n){r(n)}}function d(n){var e;n.done?o(n.value):(e=n.value,e instanceof t?e:new t((function(n){n(e)}))).then(c,a)}d((i=i.apply(n,e||[])).next())}))};function h(n){return v(this,void 0,void 0,(function*(){for(;n.firstChild;)n.removeChild(n.firstChild);const t=yield d(),i=yield t.json(),o=e(n,"div","winnersBox");e(o,"div","winnersNumber",`Winners (${i.length})`),e(o,"div","numberPage",`Page #${c.winnerPageNumber}`);const r=e(o,"div","nameRow");let a,s,l;e(r,"div","textBlock","Number"),e(r,"div","textBlock","Car"),e(r,"div","textBlock carName","Name"),"wins"===c.winnerSort&&"ASC"===c.winnerOrder?(s="Best time",a="Wins ↑",l=yield d(c.winnerPageNumber,c.winnerCarOnPage,c.winnerSort,c.winnerOrder)):"wins"===c.winnerSort&&"DESC"===c.winnerOrder?(s="Best time",a="Wins ↓",l=yield d(c.winnerPageNumber,c.winnerCarOnPage,c.winnerSort,c.winnerOrder)):"time"===c.winnerSort&&"ASC"===c.winnerOrder?(s="Best time ↑",a="Wins",l=yield d(c.winnerPageNumber,c.winnerCarOnPage,c.winnerSort,c.winnerOrder)):"time"===c.winnerSort&&"DESC"===c.winnerOrder?(s="Best time ↓",a="Wins",l=yield d(c.winnerPageNumber,c.winnerCarOnPage,c.winnerSort,c.winnerOrder)):(s="Best time",a="Wins",l=yield d(c.winnerPageNumber,c.winnerCarOnPage));const u=yield l.json();e(r,"div","textBlock wins",a).addEventListener("click",(()=>{"wins"===c.winnerSort&&"ASC"===c.winnerOrder?c.winnerOrder="DESC":("wins"===c.winnerSort&&"DESC"===c.winnerOrder||(c.winnerSort="wins"),c.winnerOrder="ASC"),h(n)})),e(r,"div","textBlock bestTime",s).addEventListener("click",(()=>{"time"===c.winnerSort&&"ASC"===c.winnerOrder?c.winnerOrder="DESC":("time"===c.winnerSort&&"DESC"===c.winnerOrder||(c.winnerSort="time"),c.winnerOrder="ASC"),h(n)}));const f=e(o,"div","lineBox");u.forEach(((n,t)=>v(this,void 0,void 0,(function*(){const i=yield fetch(`http://127.0.0.1:3000/garage/${n.id}`),o=yield i.json(),r=e(f,"div","nameRow");e(r,"div","textBlock",t+1+10*(c.winnerPageNumber-1));const a=e(r,"div","textBlock");a.innerHTML='<svg width="90" height="40" class="carSVG" viewBox="40 -20 180 180" xmlns="http://www.w3.org/2000/svg">\n    <g><title>background</title><rect fill="none" id="canvas_background" height="131" width="258" y="-1" x="-1"/></g>\n    <g><title>Layer 1</title>\n    <g id="svg_1" stroke=" none" transform="translate(1.4065934419631958,1.4065934419631958) scale(2.809999942779541) ">\n    <circle id="svg_2" stroke=" none" r="1.955" cy="34.015458" cx="71.090872"/>\n    <circle id="svg_3" stroke=" none" r="1.955" cy="34.015458" cx="20.120872"/>\n    <path id="svg_4" stroke=" none" stroke-linecap="round" d="m75.834872,13.285458l-7.987,-1.22l-2.35,-2.574c-5.599,-6.132 -13.571,-9.649 -21.874,-9.649l-6.245,0c-1.357,0 -2.696,0.107 -4.016,0.296c-0.022,0.004 -0.044,0.006 -0.066,0.01c-7.799,1.133 -14.802,5.468 -19.285,12.106c-7.95,2.899 -13.656,10.344 -13.656,17.938c0,3.254 2.647,5.9 5.9,5.9l3.451,0c0.969,4.866 5.269,8.545 10.416,8.545s9.447,-3.679 10.416,-8.545l30.139,0c0.969,4.866 5.27,8.545 10.416,8.545s9.446,-3.679 10.415,-8.545l2.947,0c3.254,0 5.9,-2.646 5.9,-5.9c0,-8.511 -6.106,-15.621 -14.521,-16.907zm-32.21,-9.443c7.065,0 13.848,2.949 18.676,8.094l-22.481,0l-3.267,-8.068c0.275,-0.009 0.55,-0.026 0.826,-0.026l6.246,0zm-11.189,0.516l3.068,7.578l-16.176,0c3.457,-3.883 8.046,-6.527 13.108,-7.578zm-12.313,36.279c-3.652,0 -6.623,-2.971 -6.623,-6.622c0,-3.652 2.971,-6.623 6.623,-6.623s6.623,2.971 6.623,6.623c0,3.652 -2.971,6.622 -6.623,6.622zm50.971,0c-3.652,0 -6.623,-2.971 -6.623,-6.622c0,-3.652 2.971,-6.623 6.623,-6.623c3.651,0 6.622,2.971 6.622,6.623c0,3.652 -2.97,6.622 -6.622,6.622z"/>\n    </g></g></svg>',a.style.fill=o.color,e(r,"div","textBlock carName",o.name),e(r,"div","textBlock",n.wins),e(r,"div","textBlock",n.time)}))));const w=e(o,"div","prevNextRow");return e(w,"button","button","PREV").addEventListener("click",(()=>{c.winnerPageNumber>1&&(c.winnerPageNumber-=1,h(n))})),e(w,"button","button","NEXT").addEventListener("click",(()=>{c.winnerPageNumber*c.winnerCarOnPage<i.length&&(c.winnerPageNumber+=1,h(n))})),o}))}const f=e(document.body,"div","wrapper"),w=e(f,"div","headerBox"),g=e(f,"div","contentBox"),y=e(f,"div","footerBox");function m(){const{hash:n}=window.location;""===n||"#/"===n||"#/garage"===n?u(g):"#/winners"===n?h(g):function(n){for(;n.firstChild;)n.removeChild(n.firstChild);e(n,"div","error","404: page not found")}(g)}window.addEventListener("hashchange",m),window.addEventListener("load",(()=>{!function(n){for(;n.firstChild;)n.removeChild(n.firstChild);const t=e(n,"div","header");e(t,"div","garagePageLink menuLink","garage").addEventListener("click",(()=>{window.location.hash="#/garage"})),e(t,"div","winnersPageLink menuLink","winners").addEventListener("click",(()=>{window.location.hash="#/winners"}))}(w),function(n){for(;n.firstChild;)n.removeChild(n.firstChild);const t=e(n,"div","footer");e(t,"div","footerText","async-race 2023")}(y),m()}))})();
//# sourceMappingURL=main.72e8458ecbd8bc61f5cf.js.map